<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Adding Thumbnails to Drupal Vimeo Support | Darren Mothersele</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>

<div class="home-logo">
  <a href="/">
<img src="/img/daz-logo.png" alt="Daz Logo" class="home-logo-img">
</a>
</div>

<hgroup class="alignCenter">
  <h1>Adding Thumbnails to Drupal Vimeo Support</h1>
        <h6>Apr 13, 2008 Â· By Darren Mothersele</h6>
  <p class="sc">web-dev</p>
</hgroup>
<p>The embedded media field is a project for Drupal that adds support to embed third party media into content types. Several video providers are already supported, and Drupal user robomalo started <a href="http://drupal.org/node/208963" rel="nofollow">adding Vimeo support</a>.</p>
<p>This works for embedding videos, but it did not support fetching thumbnails - until now! I've attached my changes to the Vimeo code that now supports thumbnails. </p>
<!--break-->
<p>Embedding video takes a couple of steps. The first is to extract the Vimeo ID number from the URL, then use this to generate the embed code. The Vimeo include file already does this, and provides some options for configuring the embed code. </p>
<p>Supporting thumbnails takes a little bit more effort, as it involves using the Vimeo API to request the video thumbnail API.</p>
<p>The embedded video field uses include files to add support for different video hosts. These include files contain the implementation for various "hooks" that are called to perform various tasks. The hook for adding thumbnail support is called video_cck_PROVIDER_thumbnail - so in this case the function to implement is video_cck_vimeo_thumbnail. This function should return the URL to the thumbnail image. </p>
<p>In order to fetch the thumbnail location, we need to make a call to getThumbnailUrl method of the Vimeo API. In order to make an API call we need to give our API key as provided by Vimeo, and we need to "sign" our request using our Shared Secret with Vimeo. I've added these to options to the video embed settings page, by adding the following code to the end of the video_cck_vimeo_settings hook implementation:</p>
<p>&lt;?php<br />
  $form['vimeo']['video_cck_vimeo_api_key'] = array(<br />
    '#type' =&gt; 'textfield',<br />
    '#title' =&gt; t('Vimeo API Key'),<br />
    '#default_value' =&gt; variable_get('video_cck_vimeo_api_key', ''),<br />
  );<br />
  $form['vimeo']['video_cck_vimeo_api_secret'] = array(<br />
    '#type' =&gt; 'textfield',<br />
    '#title' =&gt; t('Vimeo API Shared Secret'),<br />
    '#default_value' =&gt; variable_get('video_cck_vimeo_api_secret', ''),<br />
  );<br />
  $form['vimeo']['video_cck_vimeo_thumb_size'] = array(<br />
    '#type' =&gt; 'select',<br />
    '#title' =&gt; t('Vimeo Thumbnail Size'),<br />
    '#options' =&gt; array('96' =&gt; '96', '100' =&gt; '100', '160' =&gt; '160', '200' =&gt; '200', '460' =&gt; '460'),<br />
    '#default_value' =&gt; variable_get('video_cck_vimeo_thumb_size', '160'),<br />
  );<br />
?&gt;</p>
<p>Notice there's also an option to select the size of thumbnail requested from Vimeo.</p>
<p>Now using those three options we can formulate our request to the Vimeo API and generate our signature using an MD5 hash:</p>
<p>&lt;?php<br />
function video_cck_vimeo_thumbnail($field, $item, $formatter, $node, $width, $height) {<br />
  $vimeo_id = (substr($item['value'],-1,1)=='/') ? substr($item['value'],0,-1) : $item['value'];<br />
  $vimeo_signature = variable_get('video_cck_vimeo_api_secret', '') .<br />
    'api_key' . variable_get('video_cck_vimeo_api_key', '') .<br />
    'method' . 'vimeo.videos.getThumbnailUrl' .<br />
    'size' . variable_get('video_cck_vimeo_thumb_size', '160') .<br />
    'video_id' . $vimeo_id;<br />
  $vimeo_apicall = 'http://www.vimeo.com/api/rest?' .<br />
    'api_key=' . variable_get('video_cck_vimeo_api_key', '') .<br />
    '&amp;method=' . 'vimeo.videos.getThumbnailUrl' .<br />
    '&amp;size=' . variable_get('video_cck_vimeo_thumb_size', '160') .<br />
    '&amp;video_id=' . $vimeo_id .<br />
    '&amp;api_sig=' . md5($vimeo_signature);<br />
  $api_file = file_get_contents($vimeo_apicall);<br />
  $xml = new SimpleXMLElement($api_file);<br />
  return $xml-&gt;thumbnail;<br />
}<br />
?&gt;</p>
<p>Notice that I am using SimpleXML to parse the thumbnail location from the result of the Vimeo API call. This means this code requires PHP5. There may be a better way to do this, but as I always run on PHP5 this isn't a problem.</p>
<p>Usage: download the attached file, you need to place it in the "providers" subdirectory in your emfield folder.</p>



<div class="author-line">

  <figure class="author-image">
    <img src="/img/darren100.jpg" alt="Darren's Photo" class="avatar">
  </figure>

<h4>Darren Mothersele</h4>
<p>Darren is a software developer who builds simple, creative, and independent technology. <a href="/about">Read more &raquo;</a></p>
</div>




<footer>
  <p>Want to support my work? Buy my <a href="/blog/2016/06/16/php-framework-weekend/">PHP Framework</a> book.
  Available in paperback from <a href="http://amzn.to/2bNv560">Amazon</a> or eBook from <a href="https://leanpub.com/phpframework">Leanpub</a>.</p>
  <p>
    <small>
      &copy;2007-2017 <a href="/about">Darren Mothersele</a>.
        <a class="text-white" href="http://creativecommons.org/licenses/by-sa/4.0/">Some rights reserved</a>.
        <a href="/contact">Contact</a>.
        <a href="/blog/">Blog Archive</a>.
    </small>
  </p>
</footer>
</body>
</html>
