<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title> Adding Thumbnails to Drupal Vimeo Support |  Darren Mothersele</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <link rel="alternate" type="application/rss+xml" title="Darren Mothersele" href="http://www.darrenmothersele.com/rss.xml">
    
    <link rel="stylesheet" href="/css/clean.css">
</head>
<body>

<header>

<div class="top-nav">

<a href="/" class="top-nav-logo"><img src="/img/daz-logo.png" class="logo" alt="Logo" width="100"></a>

<ul class="menu menu-list">
    <li><a href="/about/">About me</a></li>
    <li><a href="/blog/">Blog</a></li>
    <li><a href="/contact/">Contact</a></li>
</ul>
</div>
<br clear="both">

</header>

<div class="page">
<h1 class="post-title">Adding Thumbnails to Drupal Vimeo Support</h1>

  <span class="">13 Apr 2008</span>


            <img class="avatar" src="/img/darren100.jpg" alt="Author" width="50">
            <p>Darren Mothersele, London UK</p>



            
              <p class="lead">The embedded media field is a project for Drupal that adds support to embed third party media into content types. Several video providers are already supported, and Drupal user robomalo started <a href="http://drupal.org/node/208963" rel="nofollow">adding Vimeo support</a>.</p>

<p class="lead">This works for embedding videos, but it did not support fetching thumbnails - until now! I've attached my changes to the Vimeo code that now supports thumbnails. </p>

              
<p>Embedding video takes a couple of steps. The first is to extract the Vimeo ID number from the URL, then use this to generate the embed code. The Vimeo include file already does this, and provides some options for configuring the embed code. </p>

<p>Supporting thumbnails takes a little bit more effort, as it involves using the Vimeo API to request the video thumbnail API.</p>

<p>The embedded video field uses include files to add support for different video hosts. These include files contain the implementation for various "hooks" that are called to perform various tasks. The hook for adding thumbnail support is called video_cck_PROVIDER_thumbnail - so in this case the function to implement is video_cck_vimeo_thumbnail. This function should return the URL to the thumbnail image. </p>

<p>In order to fetch the thumbnail location, we need to make a call to getThumbnailUrl method of the Vimeo API. In order to make an API call we need to give our API key as provided by Vimeo, and we need to "sign" our request using our Shared Secret with Vimeo. I've added these to options to the video embed settings page, by adding the following code to the end of the video_cck_vimeo_settings hook implementation:</p>

<p>&lt;?php<br />
  $form['vimeo']['video_cck_vimeo_api_key'] = array(<br />
    '#type' =&gt; 'textfield',<br />
    '#title' =&gt; t('Vimeo API Key'),<br />
    '#default_value' =&gt; variable_get('video_cck_vimeo_api_key', ''),<br />
  );<br />
  $form['vimeo']['video_cck_vimeo_api_secret'] = array(<br />
    '#type' =&gt; 'textfield',<br />
    '#title' =&gt; t('Vimeo API Shared Secret'),<br />
    '#default_value' =&gt; variable_get('video_cck_vimeo_api_secret', ''),<br />
  );<br />
  $form['vimeo']['video_cck_vimeo_thumb_size'] = array(<br />
    '#type' =&gt; 'select',<br />
    '#title' =&gt; t('Vimeo Thumbnail Size'),<br />
    '#options' =&gt; array('96' =&gt; '96', '100' =&gt; '100', '160' =&gt; '160', '200' =&gt; '200', '460' =&gt; '460'),<br />
    '#default_value' =&gt; variable_get('video_cck_vimeo_thumb_size', '160'),<br />
  );<br />
?&gt;</p>

<p>Notice there's also an option to select the size of thumbnail requested from Vimeo.</p>

<p>Now using those three options we can formulate our request to the Vimeo API and generate our signature using an MD5 hash:</p>

<p>&lt;?php<br />
function video_cck_vimeo_thumbnail($field, $item, $formatter, $node, $width, $height) {<br />
  $vimeo_id = (substr($item['value'],-1,1)=='/') ? substr($item['value'],0,-1) : $item['value'];<br />
  $vimeo_signature = variable_get('video_cck_vimeo_api_secret', '') .<br />
    'api_key' . variable_get('video_cck_vimeo_api_key', '') .<br />
    'method' . 'vimeo.videos.getThumbnailUrl' .<br />
    'size' . variable_get('video_cck_vimeo_thumb_size', '160') .<br />
    'video_id' . $vimeo_id;<br />
  $vimeo_apicall = 'http://www.vimeo.com/api/rest?' .<br />
    'api_key=' . variable_get('video_cck_vimeo_api_key', '') .<br />
    '&amp;method=' . 'vimeo.videos.getThumbnailUrl' .<br />
    '&amp;size=' . variable_get('video_cck_vimeo_thumb_size', '160') .<br />
    '&amp;video_id=' . $vimeo_id .<br />
    '&amp;api_sig=' . md5($vimeo_signature);<br />
  $api_file = file_get_contents($vimeo_apicall);<br />
  $xml = new SimpleXMLElement($api_file);<br />
  return $xml-&gt;thumbnail;<br />
}<br />
?&gt;</p>

<p>Notice that I am using SimpleXML to parse the thumbnail location from the result of the Vimeo API call. This means this code requires PHP5. There may be a better way to do this, but as I always run on PHP5 this isn't a problem.</p>

<p>Usage: download the attached file, you need to place it in the "providers" subdirectory in your emfield folder.</p>

            

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'darrenmothersele';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

</div>

<footer>



<div class="footer">

<p>
    <i class="icon">&#128681;</i>
    Brixton, London, UK
    <br>
    <i class="icon">&#9993;</i>
    <script type="text/javascript">
    var data = "&#100;&#97;&#114;&#114;&#101;&#110;&#64;&#100;&#97;&#114;"
    + "&#114;&#101;&#110;&#109;&#111;&#116;&#104;&#101;&#114;&#115;&#101;"
    + "&#108;&#101;&#46;&#99;&#111;&#109;";
    document.write(data);
    </script>
</p>

<div class="my-tinyletter">
<form action="https://tinyletter.com/dazm" method="post">
    <p>
        <label for="tlemail">To get my 'friends and family' newsletter, enter your email address:</label>
    </p>
    <p>
        <input type="text" style="width:140px" name="email" id="tlemail" />
        <input type="hidden" value="1" name="embed"/>
        <input type="submit" value="Subscribe" /><br>
        <a href="https://tinyletter.com" target="_blank" style="font-size:75%;">
            powered by TinyLetter
        </a>
    </p>
</form>
</div>


<ul class="social-icons text-right menu-list hidden-sm">


    <li><a href="https://twitter.com/mothersele"><i class="icon-twitter3"></i> Twitter</a></li>

    <li><a href="https://github.com/darrenmothersele/"><i class="icon-github"></i> GitHub</a></li>

    <li><a href="https://vimeo.com/user437927"><i class="icon-vimeo3"></i> Vimeo</a></li>

    <li><a href="https://uk.linkedin.com/in/dmothersele"><i class="icon-linkedin2"></i> LinkedIn</a></li>


</ul>


<ul class="menu-list">
    <li><a href="/contact/">Contact</a></li>
    <li><a href="/about/">About</a></li>
    <li><a href="/training/">Training</a></li>
    <li><a href="/blog/">Blog</a></li>
</ul>

<p class="sub">
    <small>
        &copy;2007-2015 Darren Mothersele.
        Unless specified otherwise, content is licensed under a
        <a class="text-white" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative
            Commons Attribution-ShareAlike 3.0 Unported License</a>.


        Source code is either released into the public domain, or under
        an MIT / BSD license where possible. If this is not possible
        (due to restrictions of the GPL) then code will be released
        as GPL. See individual project license files for details.
    </small>
</p>
</div>

</footer>

</body>
</html>
