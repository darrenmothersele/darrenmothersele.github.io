<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title> Merging, moving and manipulating Git repositories |  Darren Mothersele</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <link rel="alternate" type="application/rss+xml" title="Darren Mothersele" href="http://www.darrenmothersele.com/rss.xml">
    
    <link rel="stylesheet" href="/assets/css/main.css">
</head>
<body>


<header id="header">
    <a href="/" class="image avatar"><img src="/img/darren100.jpg" alt="" /></a>
    <h1>
       <strong>Darren Mothersele</strong> </h1><h1> Creative Technologist
    </h1>

<ul class="menu-list">
    <li><a href="/about/">About me</a></li>
    <li><a href="/blog/">Blog</a></li>
    <li><a href="/contact/">Contact</a></li>
</ul>

</header>

<!-- <header>

<div class="top-nav">

<a href="/" class="top-nav-logo"><img src="/img/daz-logo.png" class="logo" alt="Logo" width="100"></a>

<ul class="menu menu-list">
    <li><a href="/about/">About me</a></li>
    <li><a href="/blog/">Blog</a></li>
    <li><a href="/contact/">Contact</a></li>
</ul>
</div>
<br clear="both">

</header> -->

<div id="main">
<div class="page">
  <header class="post-header">
<h2 class="post-title">Merging, moving and manipulating Git repositories</h2>

  <p class="">20 Mar 2013</p>

  </header>


            
              <p class="lead">I recently had the fun job of refactoring a large project that was spread across
several Git repositories. Luckily, Git has some really useful tools for moving
things around.</p>

              

<p>First, as an aside, a link to a useful page for anyone getting into some
advanced Git work. Back when I started learning Git I found this
<a href="http://git-scm.com/2011/07/11/reset.html">explaination of Git Reset</a>
that totally expedited my understanding of Git.</p>

<p>Anyway, on with the post about moving Git branches around.</p>

<p>First merge into the master branch. We&#39;re not only moving things around to new
repos to improve the reuse across projects, we&#39;re moving toward a
<em>feature branch</em> strategy, rather than the
<em>stage/prod branching</em> we
had from <a href="http://nvie.com/posts/a-successful-git-branching-model/">this post</a>.</p>

<p>Because of this, our current version of the code was on staging branch, and
wanted to move over to the master branch. Merge into master branch, but avoid
losing the branching information by using the --no-ff flag.</p>
<figure class="highlight"><pre><code class="language-text" data-lang="text">git merge --no-ff staging
</code></pre></figure>
<p>You can delete remote branches, with</p>
<figure class="highlight"><pre><code class="language-text" data-lang="text">git push origin :staging
</code></pre></figure>
<p>This removes the staging branch from origin (it&#39;s ok the commit and branching
history was retained thanks to the --no-ff merge option).</p>

<p>Then, as mentioned in <a href="http://nuclearsquid.com/writings/subtree-merging-and-you/">
this article</a>, you add the original repo as a remote, adapt the command
to pull from github. The -f fetches the commits...</p>
<figure class="highlight"><pre><code class="language-text" data-lang="text">git remote add -f other-project git@git...
</code></pre></figure>
<p>Then prepare the sub-tree merge. Then actually read the sub tree over, applying
prefix (i.e. put it in a sub folder).</p>

<p>Commit merge and push back up to GitHub.</p>

<p><em>As an aside:</em> if you accidentally push a merge you can undo it with:</p>
<figure class="highlight"><pre><code class="language-text" data-lang="text">git revert -m 1 commit_hash
</code></pre></figure>
<p>Now I want to move some stuff from one repo to another. But I don&#39;t want the
whole lot!. So, this time I clone a brand new copy - and remove everything
I don&#39;t want:</p>
<figure class="highlight"><pre><code class="language-text" data-lang="text">git clone...
git filter-branch --subdirectory-filter dir_to_save -- -- all
</code></pre></figure>
<p>That removes everything except dir<em>to</em>save, resulting in a clean repo with only
files and history from dir<em>to</em>save.</p>

<p>Then I use the previous method to merge this remaining repo into the other repo.
I&#39;ll just repeat for good measure - don&#39;t push back this temp repo - stuff
has been removed and it only contains the stuff you don&#39;t want to keep!</p>

            

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'darrenmothersele';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>







<p>
    <i class="icon">&#128681;</i>
    London, UK
    <br>
    <i class="icon">&#9993;</i>
    <script type="text/javascript">
    var data = "&#100;&#97;&#114;&#114;&#101;&#110;&#64;&#100;&#97;&#114;"
    + "&#114;&#101;&#110;&#109;&#111;&#116;&#104;&#101;&#114;&#115;&#101;"
    + "&#108;&#101;&#46;&#99;&#111;&#109;";
    document.write(data);
    </script>
</p>

<div class="my-tinyletter">
    <h4>Updates...</h4>
<form action="https://tinyletter.com/dazm" method="post">
    <p>
        <label for="tlemail">To get my 'friends and family' newsletter, enter your email address:</label>
    </p>
    <p>
        <input type="text" name="email" id="tlemail" placeholder="Email" /><br>
        <input type="hidden" value="1" name="embed"/>
        <input type="submit" value="Subscribe" /><br>
        <a href="https://tinyletter.com" target="_blank" style="font-size:75%;">
            powered by TinyLetter
        </a>
    </p>
</form>



</div>



</div>
</div>

<!-- <footer>



<div class="footer">

<p>
    <i class="icon">&#128681;</i>
    Brixton, London, UK
    <br>
    <i class="icon">&#9993;</i>
    <script type="text/javascript">
    var data = "&#100;&#97;&#114;&#114;&#101;&#110;&#64;&#100;&#97;&#114;"
    + "&#114;&#101;&#110;&#109;&#111;&#116;&#104;&#101;&#114;&#115;&#101;"
    + "&#108;&#101;&#46;&#99;&#111;&#109;";
    document.write(data);
    </script>
</p>

<div class="my-tinyletter">
<form action="https://tinyletter.com/dazm" method="post">
    <p>
        <label for="tlemail">To get my 'friends and family' newsletter, enter your email address:</label>
    </p>
    <p>
        <input type="text" style="width:140px" name="email" id="tlemail" />
        <input type="hidden" value="1" name="embed"/>
        <input type="submit" value="Subscribe" /><br>
        <a href="https://tinyletter.com" target="_blank" style="font-size:75%;">
            powered by TinyLetter
        </a>
    </p>
</form>
</div>


<ul class="social-icons text-right menu-list hidden-sm">


    <li><a href="https://twitter.com/mothersele"><i class="icon-twitter3"></i> Twitter</a></li>

    <li><a href="https://github.com/darrenmothersele/"><i class="icon-github"></i> GitHub</a></li>

    <li><a href="https://vimeo.com/user437927"><i class="icon-vimeo3"></i> Vimeo</a></li>

    <li><a href="https://uk.linkedin.com/in/dmothersele"><i class="icon-linkedin2"></i> LinkedIn</a></li>


</ul>


<ul class="menu-list">
    <li><a href="/contact/">Contact</a></li>
    <li><a href="/about/">About</a></li>
    <li><a href="/training/">Training</a></li>
    <li><a href="/blog/">Blog</a></li>
</ul>

<p class="sub">
    <small>
        &copy;2007-2015 Darren Mothersele.
        Unless specified otherwise, content is licensed under a
        <a class="text-white" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative
            Commons Attribution-ShareAlike 3.0 Unported License</a>.


        Source code is either released into the public domain, or under
        an MIT / BSD license where possible. If this is not possible
        (due to restrictions of the GPL) then code will be released
        as GPL. See individual project license files for details.
    </small>
</p>
</div>

</footer> -->


<footer id="footer">
    <ul class="icons">
        <li><a href="https://twitter.com/mothersele" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
        <li><a href="https://github.com/darrenmothersele" class="icon fa-github"><span class="label">Github</span></a></li>
        <li><a href="mailto:darren@darrenmothersele.com" class="icon fa-envelope-o"><span class="label">
    <script type="text/javascript">
    var data = "&#100;&#97;&#114;&#114;&#101;&#110;&#64;&#100;&#97;&#114;"
    + "&#114;&#101;&#110;&#109;&#111;&#116;&#104;&#101;&#114;&#115;&#101;"
    + "&#108;&#101;&#46;&#99;&#111;&#109;";
    document.write(data);
    </script></span></a></li>
    </ul>
    <ul class="copyright">
        <li>
        &copy;2007-2016 Darren Mothersele.
        Unless specified otherwise, content is licensed under a
        <a class="text-white" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative
            Commons Attribution-ShareAlike 3.0 Unported License</a>.</li>
    </ul>
</footer>

</body>
</html>
