<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Merging, moving and manipulating Git repositories | Darren Mothersele</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>

<div class="home-logo">
  <a href="/">
<img src="/img/daz-logo.png" alt="Daz Logo" class="home-logo-img">
</a>
</div>

<hgroup class="alignCenter">
  <h1>Merging, moving and manipulating Git repositories</h1>
        <h6>Mar 20, 2013 · By Darren Mothersele</h6>
  <p class="sc">web-dev</p>
</hgroup>
<p>I recently had the fun job of refactoring a large project that was spread across
several Git repositories. Luckily, Git has some really useful tools for moving
things around.</p>

<!--break-->

<p>First, as an aside, a link to a useful page for anyone getting into some
advanced Git work. Back when I started learning Git I found this
<a href="http://git-scm.com/2011/07/11/reset.html">explaination of Git Reset</a>
that totally expedited my understanding of Git.</p>

<p>Anyway, on with the post about moving Git branches around.</p>

<p>First merge into the master branch. We’re not only moving things around to new
repos to improve the reuse across projects, we’re moving toward a
<em>feature branch</em> strategy, rather than the
<em>stage/prod branching</em> we
had from <a href="http://nvie.com/posts/a-successful-git-branching-model/">this post</a>.</p>

<p>Because of this, our current version of the code was on staging branch, and
wanted to move over to the master branch. Merge into master branch, but avoid
losing the branching information by using the –no-ff flag.</p>

<pre><code>git merge --no-ff staging
</code></pre>

<p>You can delete remote branches, with</p>

<pre><code>git push origin :staging
</code></pre>

<p>This removes the staging branch from origin (it’s ok the commit and branching
history was retained thanks to the –no-ff merge option).</p>

<p>Then, as mentioned in <a href="http://nuclearsquid.com/writings/subtree-merging-and-you/">
this article</a>, you add the original repo as a remote, adapt the command
to pull from github. The -f fetches the commits…</p>

<pre><code>git remote add -f other-project git@git...
</code></pre>

<p>Then prepare the sub-tree merge. Then actually read the sub tree over, applying
prefix (i.e. put it in a sub folder).</p>

<p>Commit merge and push back up to GitHub.</p>

<p><em>As an aside:</em> if you accidentally push a merge you can undo it with:</p>

<pre><code>git revert -m 1 commit_hash
</code></pre>

<p>Now I want to move some stuff from one repo to another. But I don’t want the
whole lot!. So, this time I clone a brand new copy - and remove everything
I don’t want:</p>

<pre><code>git clone...
git filter-branch --subdirectory-filter dir_to_save -- -- all
</code></pre>

<p>That removes everything except dir_to_save, resulting in a clean repo with only
files and history from dir_to_save.</p>

<p>Then I use the previous method to merge this remaining repo into the other repo.
I’ll just repeat for good measure - don’t push back this temp repo - stuff
has been removed and it only contains the stuff you don’t want to keep!</p>




<div class="author-line">

  <figure class="author-image">
    <img src="/img/darren100.jpg" alt="Darren's Photo" class="avatar">
  </figure>

<h4>Darren Mothersele</h4>
<p>Darren is a software developer who builds simple, creative, and independent technology. He believes this will empower humans to create a better future. <a href="/about">Read more &raquo;</a></p>
</div>


<div class="alignCenter">
  <p class="sc">Responses</p>
</div>
<p>I've removed the Disqus commenting system from my site
  to prevent your browsing activity being sent to a third party.
  No tracking is used on this site.
</p>
<p>Please bear with me while I find a replacement.
I will be porting over previous comments.
For now, if you want to comment, please
<a href="/contact">get in touch</a>.</p>



<footer>
  <p>
    <small>
      &copy;2007-2016 <a href="/about">Darren Mothersele</a>.
        <a class="text-white" href="http://creativecommons.org/licenses/by-sa/4.0/">Some rights reserved</a>.
        <a href="/contact">Contact</a>
    </small>
  </p>
</footer>
</body>
</html>
