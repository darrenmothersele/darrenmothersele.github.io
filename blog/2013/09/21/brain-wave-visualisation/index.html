<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Visualising mind activity with a hacked toy EEG | Darren Mothersele</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body class="bg-grey-lightest text-black">

<header class="py-4 overflow-hidden flex justify-center items-center border-b">
  <div class="flex-1 border-r h-8 skew-right grad-right"></div>
  <a class="no-outline" href="/">
    <svg id="logo" class="h-8 mx-8" viewBox="0 0 1140 400" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;"><path d="M60,300l60,100l-120,0l60,-100Z" style="fill:#b35738;"/><path d="M120,200l60,100l-120,0l60,-100Z" style="fill:#cf7038;"/><path d="M180,100l60,100l-120,0l60,-100Z" style="fill:#c46f3c;"/><path d="M240,0l60,100l-120,0l60,-100Z" style="fill:#d5a246;"/><path d="M360,0l60,100l-120,0l60,-100Z" style="fill:#ddc55e;"/><path d="M480,0l60,100l-120,0l60,-100Z" style="fill:#d8c571;"/><path d="M420,100l60,100l-120,0l60,-100Z" style="fill:#d5b74c;"/><path d="M180,300l60,100l-120,0l60,-100Z" style="fill:#da7535;"/><path d="M300,300l60,100l-120,0l60,-100Z" style="fill:#dd8d3d;"/><path d="M360,200l60,100l-120,0l60,-100Z" style="fill:#dda446;"/><path d="M420,300l60,100l-120,0l60,-100Z" style="fill:#826c85;"/><path d="M480,200l60,100l-120,0l60,-100Z" style="fill:#b8415b;"/><path d="M540,100l60,100l-120,0l60,-100Z" style="fill:#db3846;"/><path d="M600,0l60,100l-120,0l60,-100Z" style="fill:#e65041;"/><path d="M660,100l60,100l-120,0l60,-100Z" style="fill:#e92d41;"/><path d="M540,300l60,100l-120,0l60,-100Z" style="fill:#ce5772;"/><path d="M660,300l60,100l-120,0l60,-100Z" style="fill:#e7536b;"/><path d="M720,200l60,100l-120,0l60,-100Z" style="fill:#da2451;"/><path d="M780,300l60,100l-120,0l60,-100Z" style="fill:#c74a62;"/><path d="M840,200l60,100l-120,0l60,-100Z" style="fill:#02aeb0;"/><path d="M900,300l60,100l-120,0l60,-100Z" style="fill:#08a4a5;"/><path d="M960,400l60,-100l-120,0l60,100Z" style="fill:#0a969f;"/><path d="M840,400l60,-100l-120,0l60,100Z" style="fill:#05a9a9;"/><path d="M720,400l60,-100l-120,0l60,100Z" style="fill:#e62e4f;"/><path d="M600,400l60,-100l-120,0l60,100Z" style="fill:#e23a57;"/><path d="M480,400l60,-100l-120,0l60,100Z" style="fill:#a7506b;"/><path d="M240,400l60,-100l-120,0l60,100Z" style="fill:#dc8b3a;"/><path d="M360,400l60,-100l-120,0l60,100Z" style="fill:#dd9442;"/><path d="M120,400l60,-100l-120,0l60,100Z" style="fill:#cf6636;"/><path d="M180,300l60,-100l-120,0l60,100Z" style="fill:#d6883c;"/><path d="M240,200l60,-100l-120,0l60,100Z" style="fill:#d08a42;"/><path d="M300,100l60,-100l-120,0l60,100Z" style="fill:#ddbb49;"/><path d="M420,100l60,-100l-120,0l60,100Z" style="fill:#d1bd56;"/><path d="M480,200l60,-100l-120,0l60,100Z" style="fill:#d6bf61;"/><path d="M420,300l60,-100l-120,0l60,100Z" style="fill:#d9af48;"/><path d="M540,300l60,-100l-120,0l60,100Z" style="fill:#d1354f;"/><path d="M600,200l60,-100l-120,0l60,100Z" style="fill:#e53843;"/><path d="M660,300l60,-100l-120,0l60,100Z" style="fill:#d80b2c;"/><path d="M780,100l60,-100l-120,0l60,100Z" style="fill:#128c83;"/><path d="M900,100l60,-100l-120,0l60,100Z" style="fill:#12617a;"/><path d="M960,200l60,-100l-120,0l60,100Z" style="fill:#09889a;"/><path d="M900,300l60,-100l-120,0l60,100Z" style="fill:#03a4ae;"/><path d="M1080,400l60,-100l-120,0l60,100Z" style="fill:#107a8e;"/><path d="M1020,300l60,100l-120,0l60,-100Z" style="fill:#0d8b96;"/><path d="M900,100l60,100l-120,0l60,-100Z" style="fill:#04a1a9;"/><path d="M960,0l60,100l-120,0l60,-100Z" style="fill:#125776;"/><path d="M840,0l60,100l-120,0l60,-100Z" style="fill:#0d8088;"/><path d="M720,0l60,100l-120,0l60,-100Z" style="fill:#169b8c;"/></svg>
  </a>
  <div class="flex-1 border-l h-8 skew-left grad-left"></div>
</header>

<div id="me">
  <div class="py-8 flex justify-center items-center">
    <div class="border rounded-full p-1">
      <img class="rounded-full block" width="100" height="100"
           src="/images/darren100.jpg">
    </div>
  </div>

  <div class="text-center">

    <h1 class="text-2xl">Darren Mothersele</h1>

    <p>Software Developer</p>

  </div>
</div>

<div id="page" class="my-8 font-serif leading-normal">
  <div>
  <p class="border-4 border-red p-8 bg-red-light m-8 text-white">
    <b>Warning:</b> You are viewing old, legacy content.
    Kept for posterity.
    Information is out of date.
    Code samples probably don't work.
    My opinions have probably changed.
    Browse at your own risk.
  </p>
</div>


<div class="m-8">
  <h1>Visualising mind activity with a hacked toy EEG</h1>
  
  <p>Sep 21, 2013</p>
  
  
  <p class="text-sm uppercase">hardware</p>
  
</div>



<div class="m-8 legacy-content font-serif">
  <p>The MindFlex toy includes a headset that reads EEG wave data. There’s
lots of information on hacking this toy to create a simple EEG machine
using the limited data the headset provides by default. In this project
I have extracted the full RAW EEG data using the same toy headset from
the MindFlex game.</p>

<!--break-->

<p><strong>Update: </strong> I’ve posted an update to this blog, where I provide
details of how to extract the <a href="/blog/2013/10/07/mindflex-raw-eeg-data/">
full RAW EEG data from the MindFlex headset</a>.</p>

<p><strong>Friendly Warning and Disclaimer:</strong>
Hack your toys at your own risk. I’m not responsible for any damage you do
to yourself or your belongings. This information is provided here for
information and education only. If you use the original hack and just use the
data available in normal mode then the MindFlex still works as a game as
originally intended. If you enable RAW EEG output then you break the toy!</p>

<h2 id="reading-brain-waves">Reading brain waves</h2>

<p>An obvious place for us to start on this project might have been with the
excellent OpenEEG project, but while being open, it still has substantial
costs and complexity in getting up and running. For this project we looked
for a simpler approach.</p>

<p>EEG technology has been incorporated into various toys and household items
before. There are various commercial options available based on NeuroSky’s
ThinkGear chip.</p>

<p>The original <a href="http://frontiernerds.com/brain-hack">Frontier Nerds</a>
blog post from 2010 provides a great starting point, but I’ve made a few
changes along the way, including successfully extracting the RAW EEG values
from the MindFlex toy.</p>

<h2 id="budget-eeg-with-the-tgam1">Budget EEG with the TGAM1</h2>

<p>The TGAM1 is the controller board responsible for processing the EEG signals
in all of the products based on the NeuroSky ThinkGear chip. NeuroSky no longer
sell the boards in small quantities (I’ve had confirmation of this from
their business development team that this is due to support resources) and
instead recommend that you buy the BrainWave starter kit. This is probably a
good idea if you want easy access to EEG data, but they are still over 100 GBP
to buy in the UK, and the toys are available for only 40.</p>

<p>When you open the left compartment on the MindFlex you will see this:</p>

<p><img src="/img/project/mindflex-inner.jpg" alt="Inside the MindFlex" /></p>

<p>The small board located on the top at the bottom right is the TGAM1 board.</p>

<p>The basic hack needs just two solder points. You solder on to the <strong>T</strong>
pin to get the data out, and another connection for a common ground between
your arduino circuit and the TGAM1. I have also solder two more connections on,
which I will explain later.</p>

<p><img src="/img/project/mindflex-hack.png" alt="Connection on the TGAM1" /></p>

<h2 id="simple-eeg-reading">Simple EEG reading</h2>

<p>The basic data that comes out of the MindFlex headset by default actually gives
us quite a lot of information for only £40. In the default configuration
you have soldered on only two connections, one for a common ground and one for
the serial data stream. I connect this to a SoftwareSerial pin on the Arduino
and read in the packets. Here’s what data you get:</p>

<ul>
  <li>Signal strength (0 - 200) where 0 means good signal, and 200 indicates a problem with the connection.</li>
  <li>Attention and Meditation eSense values. These are a proprietary measure that is calculated by the TGAM1 using NeuroSky’s own algorithm. The toys based on this technology use the attention measure.</li>
  <li>EEG power band values: A measure of the various power bands that has been pre-calculated by the chip, this updates once per second.</li>
</ul>

<p>The <a href="https://github.com/kitschpatrol/Arduino-Brain-Library/">Arduino
Brain Library</a> already includes functionality for working with these
values.</p>

<h2 id="tgam1-region-change">TGAM1 Region Change</h2>

<p>If you bought the EU version and you’re in EU then skip this bit.</p>

<p>The MindFlex, MindSet, Necomimi, etc all based on the TGAM1 that includes a
notch filter on the EEG wave to remove electrical noise from the data. If you
bought a MindFlex from a different region then you will need to adapt it to
work for you. For example, if you’ve bought a headset from the US it will have
a notch filter at 60Hz. In Europe our “mains hum” is at 50Hz. You can switch
the notch filter to work at the correct frequency with a bit of soldering.</p>

<h2 id="getting-full-raw-eeg-data">Getting full RAW EEG data</h2>

<p>Now on to getting the full raw EEG data from the MindFlex headset. In addition
to the two connections you soldered on before there are two extra connections
required. This allows you to configure the TGAM1 board that is in the MindFlex
to switch between two modes. The ‘configure’ connection is actually called B1
on the TGAM1 board. In the MindFlex headset B1 is connected to GND via a 10K
resistor. I have marked this resistor with an X on the image.</p>

<p>You need to remove this 10K resistor from the circuit board, and connect B2 to
VCC via a 10K resistor to enable full raw EEG data output.</p>

<p>The full EEG data is output at the higher baud rate of 57600. You also get the
same packets as in normal mode.</p>

<p>You can switch back to normal mode, with just the basic data output at baud
rate of 9600 by connecting B1 back to GND with the 10K resistor instead of the
VCC connection.</p>

<h2 id="signal-strength">Signal strength</h2>

<p>The normal data and raw data modes both give you the summary packet once every second. In this is a measure of signal strength. It should be zero to indicate that the board is getting good measurements. Anything more than 0 indicates poor signal, and 200 is used to indicate a problem.</p>

<p>When I had the Arduino hooked up to the computer serial port I struggled to get the signal strength to 0. When running off batteries (I have an Arduino Pro mini connected to the headset’s battery pack) I have had no issues with
signal strength.</p>

<p>The issues were resolved by adding an extra GND connection from the Arduino and connecting to the body of the person being tested. I don’t recommend this
approach and running the headset completely off batteries is recommended.</p>

<p>This requires no wired connection to the computer, hence the RF link that has been implemented.</p>

<h2 id="rf-data-link">RF data link</h2>

<p>I am using a cheap low-power RF transceiver to send the EEG packets to the computer. This makes the headset wireless and solves the signal strength problem that required the extra ground connection.</p>

<h2 id="receiving-the-data">Receiving the data</h2>

<p>The <a href="https://github.com/kitschpatrol/Processing-Brain-Grapher">Processing Brain Grapher</a> is a good starting point to check everything is working but it only works when the headset is in normal mode and sending
the data via the serial port.</p>

<p>I am working on a Processing library that will work with the updated headset in full EEG mode, this giving access to the eSense meters, the EEG power band values, and the full EEG raw data. I’ll be expanding this section as I make more progress with the libraries and visualisations.</p>


</div>

</div>

<nav class="bg-grey-darker p-8 text-center text-sm">
  <ul class="list-reset">
    <li class="mx-2 inline-block">
      <a class="text-grey-lighter no-underline hover:underline" href="/about">About</a>
    </li>
    <li class="mx-2 inline-block text-grey-lighter">&#9679;</li>
    <li class="mx-2 inline-block">
      <a class="text-grey-lighter no-underline hover:underline" href="/contact">Contact</a>
    </li>
    <li class="mx-2 inline-block text-grey-lighter">&#9679;</li>
    <li class="mx-2 inline-block">
      <a class="text-grey-lighter no-underline hover:underline" href="https://medium.com/@dazcyril">Stuff I've written on Medium</a>
    </li>
    <li class="mx-2 inline-block text-grey-lighter">&#9679;</li>
    <li class="mx-2 inline-block">
      <a class="text-grey-lighter no-underline hover:underline" href="/blog">My old blog content</a>
    </li>
  </ul>
</nav>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/TweenMax.min.js"></script>
<script src="/js/scripts.js"></script>
</body>
</html>
