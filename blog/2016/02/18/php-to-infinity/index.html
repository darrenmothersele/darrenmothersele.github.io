<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Playing with Infinity in PHP | Darren Mothersele</title>
</head>
<body>

<div class="home-logo">
  <a href="/">
<img src="/img/daz-logo.png" alt="Daz Logo" class="home-logo-img">
</a>
</div>

<hgroup class="alignCenter">
  <h1>Playing with Infinity in PHP</h1>
        <h6>Feb 18, 2016 · By Darren Mothersele</h6>
  <p class="sc">web-dev</p>
</hgroup>
<p>I’ve been playing around with lazy evaluation in PHP.
This is made possible by using Generators, added to PHP 5.5
and refined in PHP 7.
You can do some cool stuff with infinite (or very
large) data sets, and avoid getting stuck in infinite loops.</p>

<!--break-->

<p>Imagine you want to create an infinitely long array of the same value.
Here’s a simple bit of code that would do this. Obviously don’t try this.
Just read the code and imagine a world where this is a good idea…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>function repeat($i)
{
    $output = [];
    while (true)
    {
        $output[] = $i;
    }
    return $output;
}
</code></pre>
</div>

<p>This function would never terminate. You get stuck in an
infinite loop. <code class="highlighter-rouge">while(true)</code> is not something you ever want to see
in a program, right?</p>

<p>Well, not if you do lazy evaluation. In this context lazy means you
only evaluate as much code as you need to get the result. So you
can have large, even infinite, sets of data, without getting stuck in
long, or infinite, loops.</p>

<p>PHP has a feature for lazy evaluation. It’s called a Generator,
summoned into being using the magical <code class="highlighter-rouge">yield</code> keyword.
Here’s the stupid repeat, but this time as a generator…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>function repeat($i)
{
    while (true)
    {
        yield $i;
    }
}
</code></pre>
</div>

<p>You have to be careful using infinite sets.
You can still easily create an unterminating program if you tried to print
out the whole of this Generator function.</p>

<p>But, what if we just wanted to work with the first 5 items from
our infinite computation. This is now possible because of lazy
evaulation. Here’s a take function that will take
any number of items from any Generator:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>function take($i, Generator $generator)
{
    while ($i-- &gt; 0 &amp;&amp; $generator-&gt;valid())
    {
        yield $generator-&gt;current();
        $generator-&gt;next();
    }
}
</code></pre>
</div>

<p>Let’s take 5…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>foreach (take(5, repeat('Hello')) as $item)
{
    echo $item, PHP_EOL;
}
</code></pre>
</div>

<p>OK, that was a stupid example. What about something a bit more
interesting? How about the classic fibonnacci sequence generator?</p>

<p>For some reason the examples I found on both
<a href="http://stackoverflow.com/questions/19835499/recursive-generators-in-php">Stack Overflow</a>
and the <a href="http://php.net/manual/en/language.generators.syntax.php">PHP Manual</a>
were more complex than they needed to be.</p>

<p>Here is the simplist infinite fibonacci generator I can think of…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>function fib()
{
    yield $i = 0;
    yield $j = 1;
    while (true) {
        yield $k = $i + $j;
        $i = $j;
        $j = $k;
    }
}
</code></pre>
</div>

<p>And here’s the first 50 fibonacci numbers…</p>

<div class="highlighter-rouge"><pre class="highlight"><code>foreach (take(50, fib()) as $item)
{
    echo $item, PHP_EOL;
}
</code></pre>
</div>

<p>And, here’s the first 10, skipping the first 0 using a tail function:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>function tail(Generator $list)
{
    $list-&gt;next();
    yield from $list;
}

foreach (take(50, tail(fib())) as $item)
{
    echo $item, PHP_EOL;
}
</code></pre>
</div>

<p>In case you’re curious, there are actual use cases for this.
For example, this <a href="https://github.com/MarkBaker/GeneratorQuadTrees">Quad Tree</a>
data structure implementation.</p>

<p>Generators may not offer better performance in terms of execution speed.
But, generator based algorythms offer a much lower memory overhead
as you’re not having to pass around the full data sets.</p>



<div class="author-line">

  <figure class="author-image">
    <img src="/img/darren100.jpg" alt="Darren's Photo" class="avatar">
  </figure>

<h4>Darren Mothersele</h4>
<p>Darren is a software developer who builds simple, creative, and independent technology. He believes this will empower humans to create a better future. <a href="/about">Read more &raquo;</a></p>
</div>


<div class="alignCenter">
  <p class="sc">Responses</p>
</div>
<p>I've removed the Disqus commenting system from my site
  to prevent your browsing activity being sent to a third party.
  No tracking is used on this site.
</p>
<p>Please bear with me while I implement a replacement
  (based on <a href="https://www.w3.org/TR/webmention/">Webmention</a>).
I will be porting over previous comments.
For now, if you want to comment, please
<a href="/contact">get in touch</a>.</p>



<footer>
  <p>
    <small>
      &copy;2007-2016 <a href="/about">Darren Mothersele</a>.
        <a class="text-white" href="http://creativecommons.org/licenses/by-sa/4.0/">Some rights reserved</a>.
        <a href="/contact">Contact</a>
    </small>
  </p>
</footer>
  <link rel="stylesheet" href="/css/styles.css">
</body>
</html>
