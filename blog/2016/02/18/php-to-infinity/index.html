<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Playing with Infinity in PHP | Darren Mothersele</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body class="bg-grey-lightest text-black">

<header class="py-4 overflow-hidden flex justify-center items-center border-b">
  <div class="flex-1 border-r h-8 skew-right grad-right"></div>
  <a class="no-outline" href="/">
    <svg id="logo" class="h-8 mx-8" viewBox="0 0 1140 400" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;"><path d="M60,300l60,100l-120,0l60,-100Z" style="fill:#b35738;"/><path d="M120,200l60,100l-120,0l60,-100Z" style="fill:#cf7038;"/><path d="M180,100l60,100l-120,0l60,-100Z" style="fill:#c46f3c;"/><path d="M240,0l60,100l-120,0l60,-100Z" style="fill:#d5a246;"/><path d="M360,0l60,100l-120,0l60,-100Z" style="fill:#ddc55e;"/><path d="M480,0l60,100l-120,0l60,-100Z" style="fill:#d8c571;"/><path d="M420,100l60,100l-120,0l60,-100Z" style="fill:#d5b74c;"/><path d="M180,300l60,100l-120,0l60,-100Z" style="fill:#da7535;"/><path d="M300,300l60,100l-120,0l60,-100Z" style="fill:#dd8d3d;"/><path d="M360,200l60,100l-120,0l60,-100Z" style="fill:#dda446;"/><path d="M420,300l60,100l-120,0l60,-100Z" style="fill:#826c85;"/><path d="M480,200l60,100l-120,0l60,-100Z" style="fill:#b8415b;"/><path d="M540,100l60,100l-120,0l60,-100Z" style="fill:#db3846;"/><path d="M600,0l60,100l-120,0l60,-100Z" style="fill:#e65041;"/><path d="M660,100l60,100l-120,0l60,-100Z" style="fill:#e92d41;"/><path d="M540,300l60,100l-120,0l60,-100Z" style="fill:#ce5772;"/><path d="M660,300l60,100l-120,0l60,-100Z" style="fill:#e7536b;"/><path d="M720,200l60,100l-120,0l60,-100Z" style="fill:#da2451;"/><path d="M780,300l60,100l-120,0l60,-100Z" style="fill:#c74a62;"/><path d="M840,200l60,100l-120,0l60,-100Z" style="fill:#02aeb0;"/><path d="M900,300l60,100l-120,0l60,-100Z" style="fill:#08a4a5;"/><path d="M960,400l60,-100l-120,0l60,100Z" style="fill:#0a969f;"/><path d="M840,400l60,-100l-120,0l60,100Z" style="fill:#05a9a9;"/><path d="M720,400l60,-100l-120,0l60,100Z" style="fill:#e62e4f;"/><path d="M600,400l60,-100l-120,0l60,100Z" style="fill:#e23a57;"/><path d="M480,400l60,-100l-120,0l60,100Z" style="fill:#a7506b;"/><path d="M240,400l60,-100l-120,0l60,100Z" style="fill:#dc8b3a;"/><path d="M360,400l60,-100l-120,0l60,100Z" style="fill:#dd9442;"/><path d="M120,400l60,-100l-120,0l60,100Z" style="fill:#cf6636;"/><path d="M180,300l60,-100l-120,0l60,100Z" style="fill:#d6883c;"/><path d="M240,200l60,-100l-120,0l60,100Z" style="fill:#d08a42;"/><path d="M300,100l60,-100l-120,0l60,100Z" style="fill:#ddbb49;"/><path d="M420,100l60,-100l-120,0l60,100Z" style="fill:#d1bd56;"/><path d="M480,200l60,-100l-120,0l60,100Z" style="fill:#d6bf61;"/><path d="M420,300l60,-100l-120,0l60,100Z" style="fill:#d9af48;"/><path d="M540,300l60,-100l-120,0l60,100Z" style="fill:#d1354f;"/><path d="M600,200l60,-100l-120,0l60,100Z" style="fill:#e53843;"/><path d="M660,300l60,-100l-120,0l60,100Z" style="fill:#d80b2c;"/><path d="M780,100l60,-100l-120,0l60,100Z" style="fill:#128c83;"/><path d="M900,100l60,-100l-120,0l60,100Z" style="fill:#12617a;"/><path d="M960,200l60,-100l-120,0l60,100Z" style="fill:#09889a;"/><path d="M900,300l60,-100l-120,0l60,100Z" style="fill:#03a4ae;"/><path d="M1080,400l60,-100l-120,0l60,100Z" style="fill:#107a8e;"/><path d="M1020,300l60,100l-120,0l60,-100Z" style="fill:#0d8b96;"/><path d="M900,100l60,100l-120,0l60,-100Z" style="fill:#04a1a9;"/><path d="M960,0l60,100l-120,0l60,-100Z" style="fill:#125776;"/><path d="M840,0l60,100l-120,0l60,-100Z" style="fill:#0d8088;"/><path d="M720,0l60,100l-120,0l60,-100Z" style="fill:#169b8c;"/></svg>
  </a>
  <div class="flex-1 border-l h-8 skew-left grad-left"></div>
</header>

<div id="me">
  <div class="py-8 flex justify-center items-center">
    <div class="border rounded-full p-1">
      <img class="rounded-full block" width="100" height="100"
           src="/images/darren100.jpg">
    </div>
  </div>

  <div class="text-center">

    <h1 class="text-2xl">Darren Mothersele</h1>

    <p>Software Developer</p>

  </div>
</div>

<div id="page" class="my-8 font-serif leading-normal">
  <div>
  <p class="border-4 border-red p-8 bg-red-light m-8 text-white">
    <b>Warning:</b> You are viewing old, legacy content.
    Kept for posterity.
    Information is out of date.
    Code samples probably don't work.
    My opinions have probably changed.
    Browse at your own risk.
  </p>
</div>


<div class="m-8">
  <h1>Playing with Infinity in PHP</h1>
  
  <p>Feb 18, 2016</p>
  
  
  <p class="text-sm uppercase">web-dev</p>
  
</div>



<div class="m-8 legacy-content font-serif">
  <p>I’ve been playing around with lazy evaluation in PHP.
This is made possible by using Generators, added to PHP 5.5
and refined in PHP 7.
You can do some cool stuff with infinite (or very
large) data sets, and avoid getting stuck in infinite loops.</p>

<!--break-->

<p>Imagine you want to create an infinitely long array of the same value.
Here’s a simple bit of code that would do this. Obviously don’t try this.
Just read the code and imagine a world where this is a good idea…</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function repeat($i)
{
    $output = [];
    while (true)
    {
        $output[] = $i;
    }
    return $output;
}
</code></pre></div></div>

<p>This function would never terminate. You get stuck in an
infinite loop. <code class="highlighter-rouge">while(true)</code> is not something you ever want to see
in a program, right?</p>

<p>Well, not if you do lazy evaluation. In this context lazy means you
only evaluate as much code as you need to get the result. So you
can have large, even infinite, sets of data, without getting stuck in
long, or infinite, loops.</p>

<p>PHP has a feature for lazy evaluation. It’s called a Generator,
summoned into being using the magical <code class="highlighter-rouge">yield</code> keyword.
Here’s the stupid repeat, but this time as a generator…</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function repeat($i)
{
    while (true)
    {
        yield $i;
    }
}
</code></pre></div></div>

<p>You have to be careful using infinite sets.
You can still easily create an unterminating program if you tried to print
out the whole of this Generator function.</p>

<p>But, what if we just wanted to work with the first 5 items from
our infinite computation. This is now possible because of lazy
evaulation. Here’s a take function that will take
any number of items from any Generator:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function take($i, Generator $generator)
{
    while ($i-- &gt; 0 &amp;&amp; $generator-&gt;valid())
    {
        yield $generator-&gt;current();
        $generator-&gt;next();
    }
}
</code></pre></div></div>

<p>Let’s take 5…</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>foreach (take(5, repeat('Hello')) as $item)
{
    echo $item, PHP_EOL;
}
</code></pre></div></div>

<p>OK, that was a stupid example. What about something a bit more
interesting? How about the classic fibonnacci sequence generator?</p>

<p>For some reason the examples I found on both
<a href="http://stackoverflow.com/questions/19835499/recursive-generators-in-php">Stack Overflow</a>
and the <a href="http://php.net/manual/en/language.generators.syntax.php">PHP Manual</a>
were more complex than they needed to be.</p>

<p>Here is the simplist infinite fibonacci generator I can think of…</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function fib()
{
    yield $i = 0;
    yield $j = 1;
    while (true) {
        yield $k = $i + $j;
        $i = $j;
        $j = $k;
    }
}
</code></pre></div></div>

<p>And here’s the first 50 fibonacci numbers…</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>foreach (take(50, fib()) as $item)
{
    echo $item, PHP_EOL;
}
</code></pre></div></div>

<p>And, here’s the first 10, skipping the first 0 using a tail function:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function tail(Generator $list)
{
    $list-&gt;next();
    yield from $list;
}

foreach (take(50, tail(fib())) as $item)
{
    echo $item, PHP_EOL;
}
</code></pre></div></div>

<p>In case you’re curious, there are actual use cases for this.
For example, this <a href="https://github.com/MarkBaker/GeneratorQuadTrees">Quad Tree</a>
data structure implementation.</p>

<p>Generators may not offer better performance in terms of execution speed.
But, generator based algorythms offer a much lower memory overhead
as you’re not having to pass around the full data sets.</p>


</div>

</div>

<nav class="bg-grey-darker p-8 text-center text-sm">
  <ul class="list-reset">
    <li class="mx-2 inline-block">
      <a class="text-grey-lighter no-underline hover:underline" href="/about">About</a>
    </li>
    <li class="mx-2 inline-block text-grey-lighter">&#9679;</li>
    <li class="mx-2 inline-block">
      <a class="text-grey-lighter no-underline hover:underline" href="/contact">Contact</a>
    </li>
    <li class="mx-2 inline-block text-grey-lighter">&#9679;</li>
    <li class="mx-2 inline-block">
      <a class="text-grey-lighter no-underline hover:underline" href="https://medium.com/@dazcyril">Stuff I've written on Medium</a>
    </li>
    <li class="mx-2 inline-block text-grey-lighter">&#9679;</li>
    <li class="mx-2 inline-block">
      <a class="text-grey-lighter no-underline hover:underline" href="/blog">My old blog content</a>
    </li>
  </ul>
</nav>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/TweenMax.min.js"></script>
<script src="/js/scripts.js"></script>
</body>
</html>
