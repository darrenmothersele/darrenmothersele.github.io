<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PHP Processing Pipeline | Darren Mothersele</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>

<div class="home-logo">
  <a href="/">
<img src="/img/daz-logo.png" alt="Daz Logo" class="home-logo-img">
</a>
</div>

<hgroup class="alignCenter">
  <h1>PHP Processing Pipeline</h1>
        <h6>Feb 11, 2016 · By Darren Mothersele</h6>
  <p class="sc">web-dev</p>
</hgroup>
<p>If you’re faced with refactoring a huge bunch of sequential code
then a pipeline may be the answer.
With a processing pipeline you create your code in stages.
Then you compose the stages into a pipeline, and pass your
input for processing.</p>

<p>This is great because each of the stages can be easily tested
independently. It also makes the code much easier to read and
maintain.</p>

<!--break-->

<p>There’s a nice and simple implementation published by the
<a href="http://thephpleague.com/">League of Extraordinary Packages</a>.
I’ve created a fork (<a href="https://github.com/darrenmothersele/pipeline">on GitHub here</a>)
which offers an even simpler syntax.</p>

<p>Here’s a very basic example to show off this new syntax.
You create your stages as simple classes with an invoke method.
For example:</p>

<p>```php
class Double {
    public function __invoke($payload)
    {
        return $payload * 2;
    }
}</p>

<p>class Square {
    public function __invoke($payload)
    {
        return $payload * $payload;
    }
}
```</p>

<p>You could even pass in parameters to the stage constructor:</p>

<p><code>php
class Add {
    private $i;
    public function __construct($i)
    {
        $this-&gt;i = $i;
    }
    public function __invoke($payload)
    {
        return $payload + $this-&gt;i;
    }
}
</code></p>

<p>Then create a <code>Pipeline</code> to chain the stages together:</p>

<p><code>php
$pipe = (new Pipeline)-&gt;Double()-&gt;Square()-&gt;Add(10);
</code></p>

<p>And then you can process values using the Pipeline:</p>

<p><code>php
echo $pipe-&gt;process(10), PHP_EOL;
</code></p>

<p>You can even process a list of values:</p>

<p><code>php
var_dump(array_map($pipe, [1, 2, 3]));
</code></p>

<p>Obviously you are not just limited to processing integers as in these
examples. XML documents, converting to JSON, filtering, translating
and other transformations are great candidates for pipelines stages.</p>

<p>I’ve submitted a pull request for my simple modification. All I did
was add an implementation of the <code>__call()</code> method so you can
add stages without having to explicitly <em>new</em>-up objects and
pass them into the <code>pipe()</code> method.</p>

<p>Hopefully my pull request gets accepted. The only thing to be aware
of is that I made use of the variadic operator, so it needs a PHP
version of 5.6 or greater.</p>




<div class="author-line">

  <figure class="author-image">
    <img src="/img/darren100.jpg" alt="Darren's Photo" class="avatar">
  </figure>

<h4>Darren Mothersele</h4>
<p>Darren is a software developer who builds simple, creative, and independent technology. He believes this will empower humans to create a better future. <a href="/about">Read more &raquo;</a></p>
</div>


<div class="alignCenter">
  <p class="sc">Responses</p>
</div>
<p>I've removed the Disqus commenting system from my site
  to prevent your browsing activity being sent to a third party.
  No tracking is used on this site.
</p>
<p>Please bear with me while I find a replacement.
I will be porting over previous comments.
For now, if you want to comment, please
<a href="/contact">get in touch</a>.</p>



<footer>
  <p>
    <small>
      &copy;2007-2016 <a href="/about">Darren Mothersele</a>.
        <a class="text-white" href="http://creativecommons.org/licenses/by-sa/4.0/">Some rights reserved</a>.
        <a href="/contact">Contact</a>
    </small>
  </p>
</footer>
</body>
</html>
