<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Drupal Theme Generator Update | Darren Mothersele</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body class="bg-grey-lightest text-black">

<header class="py-4 overflow-hidden flex justify-center items-center border-b">
  <div class="flex-1 border-r h-8 skew-right grad-right"></div>
  <a class="no-outline" href="/">
    <svg id="logo" class="h-8 mx-8" viewBox="0 0 1140 400" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;"><path d="M60,300l60,100l-120,0l60,-100Z" style="fill:#b35738;"/><path d="M120,200l60,100l-120,0l60,-100Z" style="fill:#cf7038;"/><path d="M180,100l60,100l-120,0l60,-100Z" style="fill:#c46f3c;"/><path d="M240,0l60,100l-120,0l60,-100Z" style="fill:#d5a246;"/><path d="M360,0l60,100l-120,0l60,-100Z" style="fill:#ddc55e;"/><path d="M480,0l60,100l-120,0l60,-100Z" style="fill:#d8c571;"/><path d="M420,100l60,100l-120,0l60,-100Z" style="fill:#d5b74c;"/><path d="M180,300l60,100l-120,0l60,-100Z" style="fill:#da7535;"/><path d="M300,300l60,100l-120,0l60,-100Z" style="fill:#dd8d3d;"/><path d="M360,200l60,100l-120,0l60,-100Z" style="fill:#dda446;"/><path d="M420,300l60,100l-120,0l60,-100Z" style="fill:#826c85;"/><path d="M480,200l60,100l-120,0l60,-100Z" style="fill:#b8415b;"/><path d="M540,100l60,100l-120,0l60,-100Z" style="fill:#db3846;"/><path d="M600,0l60,100l-120,0l60,-100Z" style="fill:#e65041;"/><path d="M660,100l60,100l-120,0l60,-100Z" style="fill:#e92d41;"/><path d="M540,300l60,100l-120,0l60,-100Z" style="fill:#ce5772;"/><path d="M660,300l60,100l-120,0l60,-100Z" style="fill:#e7536b;"/><path d="M720,200l60,100l-120,0l60,-100Z" style="fill:#da2451;"/><path d="M780,300l60,100l-120,0l60,-100Z" style="fill:#c74a62;"/><path d="M840,200l60,100l-120,0l60,-100Z" style="fill:#02aeb0;"/><path d="M900,300l60,100l-120,0l60,-100Z" style="fill:#08a4a5;"/><path d="M960,400l60,-100l-120,0l60,100Z" style="fill:#0a969f;"/><path d="M840,400l60,-100l-120,0l60,100Z" style="fill:#05a9a9;"/><path d="M720,400l60,-100l-120,0l60,100Z" style="fill:#e62e4f;"/><path d="M600,400l60,-100l-120,0l60,100Z" style="fill:#e23a57;"/><path d="M480,400l60,-100l-120,0l60,100Z" style="fill:#a7506b;"/><path d="M240,400l60,-100l-120,0l60,100Z" style="fill:#dc8b3a;"/><path d="M360,400l60,-100l-120,0l60,100Z" style="fill:#dd9442;"/><path d="M120,400l60,-100l-120,0l60,100Z" style="fill:#cf6636;"/><path d="M180,300l60,-100l-120,0l60,100Z" style="fill:#d6883c;"/><path d="M240,200l60,-100l-120,0l60,100Z" style="fill:#d08a42;"/><path d="M300,100l60,-100l-120,0l60,100Z" style="fill:#ddbb49;"/><path d="M420,100l60,-100l-120,0l60,100Z" style="fill:#d1bd56;"/><path d="M480,200l60,-100l-120,0l60,100Z" style="fill:#d6bf61;"/><path d="M420,300l60,-100l-120,0l60,100Z" style="fill:#d9af48;"/><path d="M540,300l60,-100l-120,0l60,100Z" style="fill:#d1354f;"/><path d="M600,200l60,-100l-120,0l60,100Z" style="fill:#e53843;"/><path d="M660,300l60,-100l-120,0l60,100Z" style="fill:#d80b2c;"/><path d="M780,100l60,-100l-120,0l60,100Z" style="fill:#128c83;"/><path d="M900,100l60,-100l-120,0l60,100Z" style="fill:#12617a;"/><path d="M960,200l60,-100l-120,0l60,100Z" style="fill:#09889a;"/><path d="M900,300l60,-100l-120,0l60,100Z" style="fill:#03a4ae;"/><path d="M1080,400l60,-100l-120,0l60,100Z" style="fill:#107a8e;"/><path d="M1020,300l60,100l-120,0l60,-100Z" style="fill:#0d8b96;"/><path d="M900,100l60,100l-120,0l60,-100Z" style="fill:#04a1a9;"/><path d="M960,0l60,100l-120,0l60,-100Z" style="fill:#125776;"/><path d="M840,0l60,100l-120,0l60,-100Z" style="fill:#0d8088;"/><path d="M720,0l60,100l-120,0l60,-100Z" style="fill:#169b8c;"/></svg>
  </a>
  <div class="flex-1 border-l h-8 skew-left grad-left"></div>
</header>

<div id="me">
  <div class="py-8 flex justify-center items-center">
    <div class="border rounded-full p-1">
      <img class="rounded-full block" width="100" height="100"
           src="/images/darren100.jpg">
    </div>
  </div>

  <div class="text-center">

    <h1 class="text-2xl">Darren Mothersele</h1>

    <p>Software Developer</p>

  </div>
</div>

<div id="page" class="my-8 font-serif leading-normal">
  <div>
  <p class="border-4 border-red p-8 bg-red-light m-8 text-white">
    <b>Warning:</b> You are viewing old, legacy content.
    Kept for posterity.
    Information is out of date.
    Code samples probably don't work.
    My opinions have probably changed.
    Browse at your own risk.
  </p>
</div>


<div class="m-8">
  <h1>Drupal Theme Generator Update</h1>
  
  <p>Apr 4, 2014</p>
  
  
  <p class="text-sm uppercase">web-dev</p>
  
</div>



<div class="m-8 legacy-content font-serif">
  <p>It’s been a week now since I demoed my proof-of-concept for an automated
theme generator at the Drupal show and tell event so I thought I’d collect together
the feedback I’ve received so far and post an update.</p>

<!--break-->

<p>###Wrong Approach?</p>

<p>Almost unanimously positive feedback. In fact, it seems other people have been
thinking along similar lines:</p>

<blockquote class="twitter-tweet" lang="en-gb"><p><a href="https://twitter.com/mothersele">@mothersele</a> dude! just saw <a href="http://t.co/GyV2m41eUe">http://t.co/GyV2m41eUe</a> This is something that <a href="https://twitter.com/jenlampton">@jenlampton</a>, <a href="https://twitter.com/mortendk">@mortendk</a>, <a href="https://twitter.com/Cottser">@Cottser</a> and I have discussed for 8.x twig!</p>&mdash; Mark Carver (@mark_carver) <a href="https://twitter.com/mark_carver/statuses/450016685752201216">March 29, 2014</a></blockquote>

<p>The one opposing view I have encountered wasn’t actually against any of the ideas
in the theme generator, but suggested that taking over Drupal markup was wrong
and that we should be working with what Drupal provides. I know there are
arguments for this, and if you want to go this route then you will need some
other mechanism for documenting the conversion of your design to Drupal theme.
If you want to argue this case, I’d suggest first try having that discussion with
<a href="https://twitter.com/mortendk">Morten</a>, as I’m going to assume that
we’re all OK with the concept of taking complete control of (completely rewriting)
Drupal’s markup output.</p>

<p>###Annotation</p>

<p>In an earlier prototype I had started working with annotations inside HTML comments
but I found these increasing harder to parse as the extractions became more
sophisticated.  Someone in conversation brought up ideas from KSS and suggested
looking at CSS comments as an alternative.</p>

<p>I’m still proposing this as a possible approach (see
<a href="https://en.wikipedia.org/wiki/Docblock">Docblock</a>), but for now I’m going to
continue to annotate the markup (not the CSS) with x- attributes, as no
one has had an issue with this, and at this stage it’s easier to work with
QueryPath to create the extractions based on these attributes.
It seems that annotating the markup with x- attributes will be acceptable
as long as they are stripped from the markup during the build process.</p>

<blockquote class="twitter-tweet" lang="en-gb"><p><a href="https://twitter.com/rootwork">@rootwork</a> <a href="https://twitter.com/illepic">@illepic</a> <a href="https://twitter.com/micahgodbolt">@micahgodbolt</a> <a href="https://twitter.com/EvanLovely">@EvanLovely</a> <a href="https://twitter.com/mothersele">@mothersele</a> Interesting! Do the data attributes get stripped out during the build step?</p>&mdash; Brad Frost (@brad_frost) <a href="https://twitter.com/brad_frost/statuses/449662512624328704">March 28, 2014</a></blockquote>

<p>It was great to get feedback from <a href="http://bradfrostweb.com/">Brad Frost</a>
as his work on Atomic Design has been influential in the development of
this process.</p>

<p>###In code, or config</p>

<p>In this first proof-of-concept, the generated theme is held in memory, well
actually it is persisted as a Drupal variable containing a single object that
holds the result of all the ‘extractions’ from the source. The original intention
was that this would actually be a ctools exportable, so that it could be exported
and managed as part of the configuration management process for the site.</p>

<p>This is how the Panels flexible layout builder works. It has one parent layout
plugin that programmatically declares child layout plugins based on the layouts
you define using the layout builder tool. These child layouts are stored as
exportable objects, so they can be exported using
<a href="https://drupal.org/project/features">Features</a>. The current Hyde theme generator
approach is similar, except that the parent plugins (for layout or styles)
programmatically declare child layout and style plugins based on the result
of each extraction from the HTML source design.</p>

<p>Storing the result of the build in configuration or database raised some concerns,
mainly over capturing the results in version control. These tweets summarise the
issue:</p>

<blockquote class="twitter-tweet" lang="en-gb"><p><a href="https://twitter.com/mothersele">@mothersele</a> interesting implementation. But I believe that should definitely generate theme in code, not just DB&#10;<a href="https://twitter.com/mcjim">@mcjim</a> <a href="https://twitter.com/MattFielding">@MattFielding</a></p>&mdash; Tom Bamford (@waako) <a href="https://twitter.com/waako/statuses/449539868411322368">March 28, 2014</a></blockquote>

<blockquote class="twitter-tweet" lang="en-gb"><p><a href="https://twitter.com/waako">@waako</a> If a prototype is always in sync with a Drupal theme, the markup *is* all in code right? // <a href="https://twitter.com/mothersele">@mothersele</a> <a href="https://twitter.com/mcjim">@mcjim</a></p>&mdash; Matt Fielding (@MattFielding) <a href="https://twitter.com/MattFielding/statuses/449551562344386560">March 28, 2014</a></blockquote>

<p>Matt picks up on my original intention, in that the design/theme would be
captured in code and be version-able because the translation is automatic from the
design’s HTML/CSS/JS.</p>

<p>The difficulty is in managing any changes that happen to the generated code
once it becomes a Drupal theme. This is exactly the problem that using the
theme generator is trying to solve. That it provides a documented, repeatable
conversion process, so that design can become part of the (agile) development workflow.</p>

<p>However, it is going to be unavoidable that some tweaking will be needed.
This covers a couple more issues that were raised at the Drupal show-and-tell
event:</p>

<ul>
  <li>How to manage logic in template files?</li>
  <li>How to capture Drupal’s pre-process functions?</li>
</ul>

<p>The approach I am looking at to solve this, is one I’ve seen practised by other
tools that involve code generation. For example, have you seen BDD using
<a href="http://behat.org/">Behat</a>? When define a test scenario in Behat it generates
stub code for any unrecognised steps in your tests. For example, if you say
“Given I am in a directory”, you would get the generated stub code:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/**
 * @Given /^I am in a directory "([^"]*)"$/
 */
public function iAmInADirectory($argument1)
{
  throw new PendingException();
}
</code></pre></div></div>

<p>I think the theme generator could do something similar for elements marked as
requiring pre-processing in the template file. This needs some further
thought and perhaps a couple of experiements.</p>

<p>###Terminology</p>

<p>Still struggling with naming conventions. If this is going to be a more general
tool then need generally understandable terms (like ‘component’). But, need
to avoid overloading terms even more, as it’s already quite confusing having
SMACSS modules, Drupal modules, panels, blocks, boxes, styles, layouts. urgh!</p>

<p>###Next steps…</p>

<blockquote class="twitter-tweet" lang="en-gb"><p><a href="https://twitter.com/mothersele">@mothersele</a> <a href="https://twitter.com/mark_carver">@mark_carver</a> I love it. Also love that it works w/ panels! Q: Are the layout plugins placed in the theme? <a href="https://twitter.com/mortendk">@mortendk</a> <a href="https://twitter.com/Cottser">@Cottser</a></p>&mdash; Jen Lampton (@jenlampton) <a href="https://twitter.com/jenlampton/statuses/450703701263388672">March 31, 2014</a></blockquote>

<p>So, I’m going to revise the current proof-of-concept and produce a second
prototype. This time as a Drush command that generates an actual Drupal theme.
Rather than holding the extracted theme in configuration it will generate
a theme folder, that will include all the usual Drupal theme files, plus any plugins for
Panels layouts, styles, display suite etc, and the CSS/JS copied across
from the source design.</p>

<p>This will allow Hyde to generate stub code for pre-processing or
other programmatic tweaks that are needed to get Drupal’s output to match the
design markup. I also think people
will be more accepting of this approach as it’s probably more like how it is
expected to work.</p>

<p>My worry is that people will then hack the generated theme, it will go
out of sync with the source design markup, and that will break the whole process.</p>

<p>If you want to get involved, please drop me a line. I need input from designers,
themers, and developers. In particular, I’d be interested to speak to anyone else
already using Atomic Design and/or SMACSS on Drupal projects.</p>



</div>

</div>

<nav class="bg-grey-darker p-8 text-center text-sm">
  <ul class="list-reset">
    <li class="mx-2 inline-block">
      <a class="text-grey-lighter no-underline hover:underline" href="/about">About</a>
    </li>
    <li class="mx-2 inline-block text-grey-lighter">&#9679;</li>
    <li class="mx-2 inline-block">
      <a class="text-grey-lighter no-underline hover:underline" href="/contact">Contact</a>
    </li>
    <li class="mx-2 inline-block text-grey-lighter">&#9679;</li>
    <li class="mx-2 inline-block">
      <a class="text-grey-lighter no-underline hover:underline" href="https://medium.com/@dazcyril">Stuff I've written on Medium</a>
    </li>
    <li class="mx-2 inline-block text-grey-lighter">&#9679;</li>
    <li class="mx-2 inline-block">
      <a class="text-grey-lighter no-underline hover:underline" href="/blog">My old blog content</a>
    </li>
  </ul>
</nav>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/TweenMax.min.js"></script>
<script src="/js/scripts.js"></script>
</body>
</html>
