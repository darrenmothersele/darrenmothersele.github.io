<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title> Kasabi Hack Day and Drupal SPARQL Views |  Darren Mothersele</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <link rel="alternate" type="application/rss+xml" title="Darren Mothersele" href="http://www.darrenmothersele.com/rss.xml">
    
    <link rel="stylesheet" href="/assets/css/main.css">
</head>
<body>


<header id="header">
    <a href="/" class="image avatar"><img src="/img/darren100.jpg" alt="" /></a>
    <h1>
       <strong>Darren Mothersele</strong> </h1><h1> Creative Technologist
    </h1>

<ul class="menu-list">
    <li><a href="/about/">About me</a></li>
    <li><a href="/blog/">Blog</a></li>
    <li><a href="/contact/">Contact</a></li>
</ul>

</header>

<!-- <header>

<div class="top-nav">

<a href="/" class="top-nav-logo"><img src="/img/daz-logo.png" class="logo" alt="Logo" width="100"></a>

<ul class="menu menu-list">
    <li><a href="/about/">About me</a></li>
    <li><a href="/blog/">Blog</a></li>
    <li><a href="/contact/">Contact</a></li>
</ul>
</div>
<br clear="both">

</header> -->

<div id="main">
<div class="page">
  <header class="post-header">
<h2 class="post-title">Kasabi Hack Day and Drupal SPARQL Views</h2>

  <p class="">17 Aug 2011</p>

  </header>


            
              <p class="lead">I recently attended a Hack Day hosted by Kasabi and <a href="http://www.brightlemon.com/">BrightLemon</a> on Open Government data and semantic web. We played around with the Kasabi services, and the available datasets. During the day I quickly put together a Drupal 7 website to demonstrate  querying a Kasabi SPARQL endpoint using Drupal and SPARQL Views. If you've not  already done so, head over to the Kasabi beta and register for an API key and find an interesting dataset you want to use. Read on for full details of how to set up a Drupal site to talk to the Kasabi services...</p>




              
<p>I had to hack around a bit on the day to make everything work. Including applying some patches from the Drupal.org issue queues to modules and generally hacking around with the code. You can read up on some of the issues via the issue queues, but luckily all these patches have made it into the official releases of the Drupal modules. In particular the patch that makes all this possible - <a href="http://drupal.org/node/1210582">the ability to specify GET parameters in SPARQL endpoints</a>. If you use the versions of the modules I have specified below, this all just works!</p>
<h3>Download and install Drupal</h3>
<p>Here's a make file you can use to download a Drupal 7 installation with the required modules for this guide. If you don't know how to use Drush Make, check the <a href="http://drupal.org/project/drush_make">documentation</a>, or download Drupal core and the modules separately from drupal.org.</p>
<p></p><div class="codeblock"><code>core = 7.x<br />api = 2<br />projects[] = drupal<br />projects[ctools][version] = 1.0-rc1<br />projects[ctools][subdir] = contrib<br />projects[views][version] = 3.0-rc1<br />projects[views][subdir] = contrib<br />projects[entity][version] = 1.0-beta10<br />projects[entity][subdir] = contrib<br />projects[rdfx][version] = 2.0-alpha3<br />projects[rdfx][subdir] = contrib<br />projects[sparql][version] = 2.0-alpha3<br />projects[sparql][subdir] = contrib<br />projects[sparql_views][version] = 2.0-beta1<br />projects[sparql_views][subdir] = contrib</code></div>
<p>Install the Drupal site as you would normally, for me I find the quickest way is the command line, using Drush...</p>
<p></p><div class="codeblock"><code>drush make kasabi.make kasabi<br />mysql -uUSERNAME -pPASSWORD -e"create database kasabi;"<br />cd kasabi<br />drush si --db-url=mysql://USERNAME:PASSWORD@localhost/kasabi<br />chmod -R a+w sites/darrenmothersele.com/files</code></div>
<p>The first line uses Drush Make to download Drupal and the required modules into a folder called "kasabi". The second line creates a database. Then change to the site folder. The next line uses Drush to run the Drupal installed, using the database we just created. Then we give the webserver permission to write to the files folder. </p>
<p><img src="/img/2011-08-17-kasabi-hack-day-and-drupal-sparql-views/1_installed_drupal7.png" width="450px" /></p>
<p>You now have a Drupal 7 site up and running, to which you can login with username admin and password admin. I'm doing all this on a dev box, but you should go ahead and change these login details after your first login. </p>
<h3>Enable and configure the required modules</h3>
<p>In this example I've turned off some core modules to clear up the interface a bit, this includes things like overlay. I've then enabled these additional contributed modules:</p>
<ul><li>Chaos tools</li>
<li>Entity API</li>
<li>RDF UI</li>
<li>RDFx</li>
<li>SPARQL API</li>
<li>SPARQL Endpoint</li>
<li>SPARQL Endpoints Registry</li>
<li>SPARQL Views</li>
<li>Related Resource</li>
<li>Views</li>
<li>Views UI</li>
</ul><p>I then need to download the ARC2 library that is required by the RDFx modules. To do this I run the following back at the command line:</p>
<p></p><div class="codeblock"><code>cd sites/all/modules/contrib/rdfx<br />mkdir vendor<br />cd vendor<br />wget http://github.com/semsol/arc2/tarball/master<br />mv master arc.tgz<br />tar xzf arc.tgz<br />mv semsol-arc2-495d10b arc</code></div>
<p>You can now navigate to admin/reports/status to check we've succesfully installed everything and our Drupal site is ready to go.</p>
<h3>Configure RDFx and SPARQL Endpoints</h3>
<p>In the "Structure" section of the Drupal admin, go to the "SPARQL Endpoint Registry" and select "Add SPARQL endpoint". In this configuration form enter the details of the Kasabi SPARQL endpoint you want to use, and your API key for the Kasabi service.  </p>
<p><img src="/img/2011-08-17-kasabi-hack-day-and-drupal-sparql-views/2_add_endpoint.png" width="450px" /></p>
<p>As you can see in the image above, for this example, I've selected the endpoint for reading data about NHS Organisations. I've also entered a query parameter for apikey=whateveryourapikeyis.</p>
<h3>Add prefix mapping for namespaces</h3>
<p>The next step is to add the mappings for the prefixes for any RDF namespaces you want to use. To find this configuration, in the "Configuration" section of the Drupal admin, click "RDF publishing settings" and then the tab labelled "RDF namespaces". At the bottom of this page you can add extra mappings. I've added the following mappings:</p>
<p></p><div class="codeblock"><code>nhs -&gt; http://data.kasabi.com/dataset/nhs-organization/def/<br />org -&gt; http://www.w3.org/ns/org#<br />os  -&gt; http://data.ordnancesurvey.co.uk/ontology/postcode/</code></div>
<p><img src="/img/2011-08-17-kasabi-hack-day-and-drupal-sparql-views/3_add_namespaces.png" width="450px" /></p>
<h3>Add SPARQL Views resource</h3>
<p>SPARQL Views allows you to use Drupal's powerful query builder (Views) to create SPARQL queries. In order to do this SPARQL Views needs to know what kind of resources we will be querying. </p>
<p>Back in the "Structure" section of the Drupal admin, go to "SPARQL Views resource types" and select "Add SPARQL Views resource". Give your resource a name and select the SPARQL endpoint this applies to.</p>
<p><img src="/img/2011-08-17-kasabi-hack-day-and-drupal-sparql-views/3_create_views_resource.png" width="450px" /></p>
<p>Now, back on the "SPARQL Views resource type" page select "manage fields" on your newly created resource type. Add fields for all the attributes we are interested in giving each field a human readable name and an internal identifier. You can use the field type "text" for each one, what is important is the RDF mapping that you specify for each field. When you add a field, on the configuration page for the field you will see a section to enter the RDF mapping:</p>
<p><img src="/img/2011-08-17-kasabi-hack-day-and-drupal-sparql-views/4_add_fields.png" width="450px" /></p>
<p><img src="/img/2011-08-17-kasabi-hack-day-and-drupal-sparql-views/4a_rdf_mapping.png" width="450px" /></p>
<p>When you're finished you have all the fields configured, with their mappings to RDF predicates.</p>
<p><img src="/img/2011-08-17-kasabi-hack-day-and-drupal-sparql-views/5_rdf_mappings.png" width="450px" /></p>
<h3>Configure Views</h3>
<p>In the Structure section of the Drupal admin, go to "Views". You might want to adjust some Views settings under the "Settings" tab. I've turned off automatic update of the preview, and turned on "Show the SQL query". Useful for debugging.</p>
<p>Now, back on the Views list, click "add new view". Give the view a name, and select the "SPARQL Views: NHS Organization" (or whatever entity you created) as the View type. Click "Continue &amp; edit"</p>
<p><img src="/img/2011-08-17-kasabi-hack-day-and-drupal-sparql-views/6_add_view.png" width="450px" /></p>
<p>This takes you to the main View admin:</p>
<p><img src="/img/2011-08-17-kasabi-hack-day-and-drupal-sparql-views/7_views_admin.png" width="450px" /></p>
<p>If you click "Update preview" you can see that a very basic query has been created for you as a starting point. The query is:</p>
<p></p><div class="codeblock"><code>SELECT DISTINCT ?nhs_organization<br />WHERE {<br />?nhs_organization ?p ?o  } <br />LIMIT 10</code></div>
<p>You can start to adapt this by adding fields and filters, changing settings such as the pager settings. Note that some Views options don't work yet. Paging for example is not fully functional because it's not possible to do the required queries in SPARQL yet. When we get support for aggregate functions in SPARQL 1.1 this should be possible.</p>
<p>Here's an example query I created. I created a page display, using the table style plugin, and added the following fields. This is the query generated:</p>
<p></p><div class="codeblock"><code>PREFIX org: &lt;http://www.w3.org/ns/org#&gt;<br />PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;<br />PREFIX nhs: &lt;http://data.kasabi.com/dataset/nhs-organization/def/&gt;<br />PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;<br />SELECT DISTINCT ?nhs_organization_field_org_id ?nhs_organization_field_org_name ?nhs_organization_field_org_healtharea ?nhs_organization_field_org_healthauthority<br />WHERE {<br />?nhs_organization rdfs:label ?nhs_organization_field_org_name; rdf:type &lt;http://data.kasabi.com/dataset/nhs-organization/def/GeneralPractice&gt;.<br /> OPTIONAL {?nhs_organization org:identifier ?nhs_organization_field_org_id}<br />OPTIONAL {?nhs_organization nhs:healthArea ?nhs_organization_field_org_healtharea}<br />OPTIONAL {?nhs_organization nhs:healthAuthority ?nhs_organization_field_org_healthauthority}<br /> } <br />LIMIT 50</code></div>
<p>And the result looks like this:</p>
<p><img src="/img/2011-08-17-kasabi-hack-day-and-drupal-sparql-views/8_view_example.png" width="450px" /></p>
<p>Notice how I have created a second view which is linked to from this view. I have passed an argument to the second view, which then filters on the memberOf property to show all members of this organisation. You can acheive this by using the powerful Views field rewriting to output a field as a link, using the ID as a token in this link that is substituted when displayed. The second view has a "Contextual filter" defined (look in the "Advanced" section of your views admin).</p>
<p>This is just the start of what is possible using SPARQL endpoints and Views. All without writing a single line of SPARQL code! If you are already familiar with Views 3 then hopefully you know how to start using this stuff. If not then I suggest going and looking up some of the excellent guides on using Views that can be found on the web. If you want to look more into what is possible with these modules then <a href="http://www.ibm.com/developerworks/library/wa-datasets/">this article</a> is a good starting point.</p>

            

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'darrenmothersele';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>







<p class="h-card">

  <a class="p-name u-url" href="http://www.darrenmothersele.com">Darren Mothersele</a>
    <i class="icon">&#128681;</i>
    <span class="p-locality">London</span>, <span class="p-country-name">UK</span>
    <br>
    <i class="icon">&#9993;</i>
  <a class="u-email" href="mailto:darren@darrenmothersele.com">darren@darrenmothersele.com</a>
</p>

<div class="my-tinyletter">
    <h4>Updates...</h4>
<form action="https://tinyletter.com/dazm" method="post">
    <p>
        <label for="tlemail">To get my 'friends and family' newsletter, enter your email address:</label>
    </p>
    <p>
        <input type="text" name="email" id="tlemail" placeholder="Email" /><br>
        <input type="hidden" value="1" name="embed"/>
        <input type="submit" value="Subscribe" /><br>
        <a href="https://tinyletter.com" target="_blank" style="font-size:75%;">
            powered by TinyLetter
        </a>
    </p>
</form>



</div>



</div>
</div>

<!-- <footer>



<div class="footer">

<p>
    <i class="icon">&#128681;</i>
    Brixton, London, UK
    <br>
    <i class="icon">&#9993;</i>
    <script type="text/javascript">
    var data = "&#100;&#97;&#114;&#114;&#101;&#110;&#64;&#100;&#97;&#114;"
    + "&#114;&#101;&#110;&#109;&#111;&#116;&#104;&#101;&#114;&#115;&#101;"
    + "&#108;&#101;&#46;&#99;&#111;&#109;";
    document.write(data);
    </script>
</p>

<div class="my-tinyletter">
<form action="https://tinyletter.com/dazm" method="post">
    <p>
        <label for="tlemail">To get my 'friends and family' newsletter, enter your email address:</label>
    </p>
    <p>
        <input type="text" style="width:140px" name="email" id="tlemail" />
        <input type="hidden" value="1" name="embed"/>
        <input type="submit" value="Subscribe" /><br>
        <a href="https://tinyletter.com" target="_blank" style="font-size:75%;">
            powered by TinyLetter
        </a>
    </p>
</form>
</div>


<ul class="social-icons text-right menu-list hidden-sm">


    <li><a href="https://twitter.com/mothersele"><i class="icon-twitter3"></i> Twitter</a></li>

    <li><a href="https://github.com/darrenmothersele/"><i class="icon-github"></i> GitHub</a></li>

    <li><a href="https://vimeo.com/user437927"><i class="icon-vimeo3"></i> Vimeo</a></li>

    <li><a href="https://uk.linkedin.com/in/dmothersele"><i class="icon-linkedin2"></i> LinkedIn</a></li>


</ul>


<ul class="menu-list">
    <li><a href="/contact/">Contact</a></li>
    <li><a href="/about/">About</a></li>
    <li><a href="/training/">Training</a></li>
    <li><a href="/blog/">Blog</a></li>
</ul>

<p class="sub">
    <small>
        &copy;2007-2015 Darren Mothersele.
        Unless specified otherwise, content is licensed under a
        <a class="text-white" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative
            Commons Attribution-ShareAlike 3.0 Unported License</a>.


        Source code is either released into the public domain, or under
        an MIT / BSD license where possible. If this is not possible
        (due to restrictions of the GPL) then code will be released
        as GPL. See individual project license files for details.
    </small>
</p>
</div>

</footer> -->



<footer id="footer">
    <ul class="icons">
        <li><a href="https://twitter.com/mothersele" rel="me" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
        <li><a href="https://github.com/darrenmothersele" rel="me" class="icon fa-github"><span class="label">Github</span></a></li>
        <li><a href="mailto:darren@darrenmothersele.com" class="icon fa-envelope-o"><span class="label">
    <script type="text/javascript">
    var data = "&#100;&#97;&#114;&#114;&#101;&#110;&#64;&#100;&#97;&#114;"
    + "&#114;&#101;&#110;&#109;&#111;&#116;&#104;&#101;&#114;&#115;&#101;"
    + "&#108;&#101;&#46;&#99;&#111;&#109;";
    document.write(data);
    </script></span></a></li>
    </ul>
    <ul class="copyright">
        <li>
        &copy;2007-2016 Darren Mothersele.
        Unless specified otherwise, content is licensed under a
        <a class="text-white" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative
            Commons Attribution-ShareAlike 3.0 Unported License</a>.</li>
    </ul>
</footer>

</body>
</html>
